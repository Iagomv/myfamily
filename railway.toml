# Railway configuration for MyFamily monorepo

[build]
# Backend service
[services.backend]
build.dockerfile = "./backend/myfamily/Dockerfile.prod"
build.context = "./backend/myfamily"

[services.backend.variables]
SPRING_PROFILES_ACTIVE = "prod"
JWT_SECRET = "${{ secrets.JWT_SECRET }}"

[[services.backend.ports]]
port = 8080

# Frontend service  
[services.frontend]
build.dockerfile = "./frontend/myFamily/Dockerfile.prod"
build.context = "./frontend/myFamily"

[[services.frontend.ports]]
port = 80

# PostgreSQL database
[services.postgres]
image = "postgres:15-alpine"

[services.postgres.variables]
POSTGRES_DB = "myfamily_db"
POSTGRES_USER = "admin"
POSTGRES_PASSWORD = "${{ secrets.DATABASE_PASSWORD }}"

[[services.postgres.volumes]]
name = "postgres_data"
path = "/var/lib/postgresql/data"

[[services.postgres.ports]]
port = 5432
